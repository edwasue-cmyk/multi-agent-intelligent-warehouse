# Vulnerability Mitigations

This document describes how the Warehouse Operational Assistant addresses known vulnerabilities through application-level protections when library-level fixes are not available or when vulnerabilities are disputed.

## PyJWT Weak Encryption (CVE-2025-45768) - DISPUTED

### Vulnerability Status
- **CVE**: CVE-2025-45768 (BDSA, NVD)
- **Status**: **DISPUTED** by vendor
- **PyJWT Version**: 2.10.1 (latest)
- **Vendor Position**: Key length is chosen by the application, not the library

### Why Scanners Flag This
Vulnerability scanners check library versions and flag PyJWT 2.10.1 as potentially vulnerable because:
- The CVE is listed in vulnerability databases
- Scanners don't analyze application-level protections
- The vulnerability is disputed, not patched at the library level

### Our Mitigation
**Status**: âœ… **MITIGATED** through application-level validation

We've implemented comprehensive key strength validation in `src/api/services/auth/jwt_handler.py`:

1. **Key Length Validation**:
   - Enforces minimum 32 bytes (256 bits) for HS256 per RFC 7518 Section 3.2
   - Recommends 64+ bytes (512 bits) for better security
   - Validates at application startup

2. **Production Protection**:
   - Weak keys are **rejected** in production (application exits)
   - Application will not start with weak keys
   - Clear error messages guide users to generate secure keys

3. **Development Warnings**:
   - Weak keys generate warnings in development
   - Developers are informed about security requirements
   - Default dev key is clearly marked as insecure

4. **Standards Compliance**:
   - RFC 7518 Section 3.2 (JWS HMAC SHA-2 Algorithms)
   - NIST SP800-117 (Key Management)
   - Industry best practices

### Verification
The validation is active and tested:
```python
# Weak keys are rejected:
validate_jwt_secret_key('short-key', 'HS256', 'production')  # Raises ValueError

# Minimum keys are accepted:
validate_jwt_secret_key('a' * 32, 'HS256', 'production')  # Returns True

# Recommended keys are accepted:
validate_jwt_secret_key('a' * 64, 'HS256', 'production')  # Returns True
```

### Handling Security Scans
When security scanners flag PyJWT 2.10.1:

1. **Document as False Positive**: The vulnerability is mitigated through application-level validation
2. **Reference This Document**: Point to this mitigation documentation
3. **Explain**: The CVE is disputed, and we've implemented the recommended application-level protection
4. **Verify**: Confirm that `JWT_SECRET_KEY` validation is active in your deployment

### Code References
- **Implementation**: `src/api/services/auth/jwt_handler.py` (lines 23-76)
- **Documentation**: `docs/secrets.md` (CVE-2025-45768 section)
- **Commit**: `2ad0a11` - "fix: add JWT secret key strength validation"

### Conclusion
**Risk Level**: **NONE** - The vulnerability is mitigated through application-level key validation that enforces minimum key lengths per security standards.

